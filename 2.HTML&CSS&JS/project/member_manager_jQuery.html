<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
</head>
<style>
    *{
        margin: 0;
        padding: 0;
    }
    a{
        cursor: pointer;
    }
    #main_wrap{
        margin: 0 auto;
        padding: 10px;
        width: 478px;
        border: 2px solid #000;
        border-radius: 5px;
/*        background-color: skyblue;*/
    } 
    .title{
        font-size: 24px;
        text-transform: uppercase;
    }
    hr{
        margin: 10px 0;
        border: none;
        border-top: 2px solid #000;
        
    }
    
    #regBox table{
        width: 100%;
    }
    
    #regBox table td{
        width: 25%;
    }
    .input{
        display: block;
        margin-top: 5px;
        padding: 10px 12px;
        width: 100%;
        border-color: #000;
        box-sizing: border-box;
        font-size: 12px;
        
    }
    input[type="submit"]{
/*        margin-top: 15px;*/
        padding: 8px 0 9px;
        border: none;
        border-radius: 4px;
        background-color: black;
        color: #fff;
        font-size: 16px;
        font-weight: bold;
    }
    
    .table{
        margin-top: 5px;
        width: 100%;
        border-collapse: collapse;
    }
    .table td{
        padding: 5px;
        text-align: center;
        border: 2px solid;
        font-size: 14px;
    }
    #edit_box{
        display: none;
        position: absolute;
        padding: 10px;
        left: 50%;
        top: 100px;
        transform: translate(-50%);
        border: 2px solid #000;
        border-radius: 5px;
        background-color: #fff;
    }
    #edit_box label{
        display: block;
        font-size: 14px;
        font-weight: bold;
        padding-right: 5px;
    }
    
    #edit_box #cancel::before{
        display: block;
        content:'ddd';
        width:10px;
        height: 20px;
        background-color:
        
    }
    #edit_box #cancel{
/*        overflow: hidden;*/
/*        position: absolute;*/
        width: 100%;
/*        height: 20px;*/
        border: none;
/*        background-color: #000;*/
/*        transform: rotate(45deg);*/
    }
    #edit_box #cancel::after{
        content:'dhdldfksljdfklsjfkl sjdlfksjdklfjsklfjlskjdfklsjfk';
    }
    
    
</style>
<body>
    
    
    <div id="main_wrap">
        <h1 class="title">member manager</h1>
        <hr>
        <div id="regBox">
            <h3>회원 등록</h3>
            <form id="regForm" type="post">
                <table>
                    <tr>
                        <td>
<!--                            <label for="userID">아이디(이메일)</label>-->
                            <input type="text" id="userID" name="userID" class="input" placeholder="아이디 (이메일)">
                        </td>
                        <td>
<!--                            <label for="userPW">비밀번호</label>-->
                            <input type="password" id="userPW" name="userPW" class="input" placeholder="비밀번호">
                        </td>
                        <td>
<!--                            <label for="userName">이름</label>-->
                            <input type="text" id="userName" name="userName" class="input" placeholder="이름">
                        </td>
                        <td>
                            <input type="submit" value="등록" class="input">
                        </td>
                    </tr>
                </table>
            </form>
        </div>
        <hr>
        <h3>회원 리스트</h3>
        <div id="memberlist">
            <table class="table">
                <tbody id="listRow">
                <tr>
                    <td>index</td>
                    <td>아이디</td>
                    <td>비밀번호</td>
                    <td>이름</td>
                    <td>관리</td>
                </tr>
                </tbody>
            </table>
        </div>
        <div id="edit_box">
            <h3>데이터 수정</h3>
            <hr>
            <form action="" id="editForm" method="post">
                <table class="editTable">
                    <tr>
                        <td><label for="editID">아이디 (이메일)</label></td>
                        <td><input type="text" class="input" id="editID"></td>

                    </tr>
                    <tr>
                        <td><label for="editPW">비밀번호</label></td>
                        <td><input type="password" class="input" id="editPW"></td>
                    </tr>
                    <tr>
                        <td><label for="editName">이름</label></td><td><input type="text" class="input" id="editName"><input type="hidden" id="editIndex"></td>
                    </tr>
                    <tr><td colspan="2"><input type="submit" value="수정" class="input"><input type="button" value="취소" id="cancel"></td></tr>
                </table>
            </form>
        </div>
    </div>
    
    
    <script>
    
    $(document).ready(function(){
        
        
        var members;
        var regForm = $('#regForm');
        var userId = $('#userID');
        var userPw = $('#userPW');
        var userName = $('#userName');
        
        function Member(id,pw,name){
            this.userId = id;
            this.userPw = pw;
            this.userName = name;
        }
        
        regForm.on('submit', function(e){
            
            setListTable();
            return false;
        });
        
        

        // 로컬스토리지에서 받아올 아이템이 없다면 null값이 나오니까 false값을 반환할거임!
        // console.log(localStorage.getItem) // 현재 아무 값이 없다면 null!
//        if(!localStorage.getItem('members')){
//            members = [];
//            //localStorage에 배열을 저장!
//            localStorage.setItem('members',JSON.stringify(members));
//        } else{
//            // 로컬스토리지에 members가 존재하는 경우임
//            members = JSON.parse(localStorage.getItem('members'));
//            console.log(members)
//            setList();
//        }
//        var editBox = document.getElementById('edit_box');
//
//
//        function Member(id, pw, name){
//            this.userId = id;
//            this.userPW = pw;
//            this.userName = name;
//        }


        // input으로 데이터를 받으면 그 사용자 데이터를 가지고 HTML 텍스트를 새로 생성해서 뿌려줄거임. 그 생성할 메소드를 정의.
    //    Member.prototype.makeHtml = function(index){
    //        
    //        var nHtml = '';
    //        
    //        nHtml += '<tr>\n';
    //        nHtml += '  <td>'+index+'</td>\n';
    //        nHtml += '  <td>'+this.userId+'</td>\n';
    //        nHtml += '  <td>'+this.userPW+'</td>\n';
    //        nHtml += '  <td>'+this.userName+'</td>\n';
    //        nHtml += '  <td><a onclick="editMember('+index+')">수정</a> | <a onclick="delMember('+index+')">삭제</a></td>\n';
    //        nHtml += '</tr>\n';
    //        
    //        return nHtml;
    //    
    //    };

    //    Member.prototype.showData = function(){
    //        alert('아이디 :'+this.userId+' \n 비밀번호 : '+this.userPW+'\n이름 : '+this.userName)
    //    }
    //    Member.prototype.toString = function(){
    //        var str = '<h4>아이디 : '+this.userId+', 비밀번호 : '+this.userPW+', 이름 : '+this.userName+'</h4>';
    //        return str;
    //    }

        window.onload = function(){
            var regForm = document.getElementById('regForm');
            var listRow = document.getElementById('listRow');
            var editForm = document.getElementById('editForm');
            var cBtn = document.getElementById('cancel');

            cBtn.onclick = function(){
                editBox.style.display = 'none';
            }

            regForm.onsubmit = function(){
                var uId = document.getElementById('userID');
                var uPw = document.getElementById('userPW');
                var uName = document.getElementById('userName');


                if(uId.value.length == 0){
                    alert('아이디를 입력해주세요.');
                    uId.focus();
                    return false;
                }

                if(uPw.value.length<1){
                    alert('비밀번호를 입력해주세요.');
                    uPw.focus();
                    return false;
                }
                if(uName.value.length<1){
                    alert('이름을 입력해주세요.');
                    uName.focus();
                    return false;
                }


                var newMember = new Member(uId.value,uPw.value,uName.value);

                members.push(newMember);
                localStorage.setItem('members',JSON.stringify(members));

                alert('정상적으로 입력되었습니다.')
                setList();
    //            
                regForm.reset();

                return true;
            };

            editForm.onsubmit = function(){
    //            console.log(members);
                var editId = document.getElementById('editID');
                var editPw = document.getElementById('editPW');
                var editName = document.getElementById('editName');
                var editIndex = document.getElementById('editIndex');



            // 입력값이 없으면 경고창 띄우기.
                if(editId.value.length<1){
                    alert('수정할 아이디를 입력해주세요.');
                    editId.focus();
                    return false;
                }

                if(editPw.value.length<1){
                    alert('수정할 비밀번호를 입력해주세요.');
                    editPw.focus();
                    return false;
                }
                if(editName.value.length<1){
                    alert('수정할 이름을 입력해주세요.');
                    editName.focus();
                    return false;
                }

                members[editIndex.value].userId = editId.value;
                members[editIndex.value].userPW = editPw.value;
                members[editIndex.value].userName = editName.value;

                console.log(members[editIndex.value]);
                setList();

                editForm.reset();
                alert('정상적으로 수정되었습니다.')

                editBox.style.display = 'none';
                return false;
            };

        };



        // members 배열의 요소 하나씩 출력하기
        function setList(){
            var newHtml = '<tr>\n   <td>index</td>\n<td>아이디</td>\n<td>비밀번호</td>\n<td>이름</td>\n<td>관리</td>\n</tr>';

            for(var i=0;i<members.length;i++){
                newHtml += '<tr>\n';
                newHtml += '  <td>'+i+'</td>\n';
                newHtml += '  <td>'+members[i].userId+'</td>\n';
                newHtml += '  <td>'+members[i].userPW+'</td>\n';
                newHtml += '  <td>'+members[i].userName+'</td>\n';
                newHtml += '  <td><a onclick="editMember('+i+')">수정</a> | <a onclick="delMember('+i+')">삭제</a></td>\n';
                newHtml += '</tr>\n';
                }

                    // alert(newHtml);
                listRow.innerHTML = newHtml;
        }
        function editMember(index){
            alert(index+'번 요소 수정');


            editBox.style.display = 'block';

            // 수정 박스 내 아이디,비밀번호,이름 input요소 캐스팅함.
            var editId = document.getElementById('editID');
            var editPw = document.getElementById('editPW');
            var editName = document.getElementById('editName');
            var eIndex = document.getElementById('editIndex');


            editId.value = members[index].userId;
            editPw.value = members[index].userPW;
            editName.value = members[index].userName;
            eIndex.value = index;

            localStorage.setItem('members',JSON.stringify(members));

        };

        function delMember(index){
    //        alert(index+'번 요소 삭제');
            var delChk = confirm("삭제하시겠습니까??????????");

            if(delChk){
                members.splice(index,1);
                setList();
                localStorage.setItem('members',JSON.stringify(members));
                alert('삭제를 완료했습니다.');
            } else{
                alert('취소했습니당.');
            }

        }

    });    
        
    </script>
</body>
</html>